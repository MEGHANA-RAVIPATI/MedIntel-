# -*- coding: utf-8 -*-
"""MedIntel.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1OXrgNCbhYzeF6FVTmznYCRFS349sGM_I
"""

!pip install -q transformers accelerate gradio

import gradio as gr
from transformers import pipeline
import torch

# ‚úÖ GPU detection for speed
device = 0 if torch.cuda.is_available() else -1

# ‚úÖ Load Granite model (fast enough for Colab)
pipe = pipeline(
    "text-generation",
    model="ibm-granite/granite-3b-code-instruct",  # swap to granite-350m if you want faster
    token="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",
    device=device
)

# ‚úÖ Chatbot response function
def respond(message, history):
    output = pipe(message, max_new_tokens=100, do_sample=True, temperature=0.7)[0]["generated_text"]
    history = history + [(message, output)]
    return history, history

# ‚úÖ Intro animation (CSS + JS inside Gradio HTML)
intro_html = """
<div style="text-align:center; background-color:#FDE992; height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;">
  <div id="pill" style="width:80px; height:40px; background:linear-gradient(90deg, pink, lightgreen); border-radius:20px; animation:spin 2s linear infinite;"></div>
  <h1 id="appname" style="opacity:0; font-size:40px; margin-top:20px; color:#333;">MedIntel</h1>
  <h3 id="tagline" style="opacity:0; margin-top:10px; color:#555;">Where Health Meets Intelligence üë®‚Äç‚öïÔ∏èüëã</h3>
</div>

<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expandFade {
  0% {transform:scale(1); opacity:1;}
  100% {transform:scale(3); opacity:0;}
}
</style>

<script>
setTimeout(() => {
  document.getElementById("pill").style.animation = "expandFade 2s forwards";
  setTimeout(() => {
    document.getElementById("appname").style.opacity = 1;
    document.getElementById("tagline").style.opacity = 1;
  }, 2000);
}, 2000);
</script>
"""

with gr.Blocks() as demo:
    with gr.Tab("Intro"):
        gr.HTML(intro_html)
    with gr.Tab("Chat"):
        chatbot = gr.Chatbot()
        msg = gr.Textbox(label="Your message")
        clear = gr.Button("Clear")
        msg.submit(respond, [msg, chatbot], [chatbot, chatbot])
        clear.click(lambda: None, None, chatbot, queue=False)

demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM
import torch

# --- Use Granite 350M for speed ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer, device=0 if torch.cuda.is_available() else -1)

# --- Store user info ---
user_info = {"email": None, "history": None}

# --- Simple dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    drug = drug.lower()
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {age}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded. Please upload a prescription image.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(f"Extract structured drug info from: {text}", max_new_tokens=120, temperature=0.7)[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text: {text}<br>üíé Vaidya Output:<br>{granite_out}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Gradio UI ---
with gr.Blocks(css="""
.gradio-container {background-color: #FDE992}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    with gr.Tab("Features"):
        feature_choice = gr.Radio(["Drug Interaction Detection",
                                   "Age-Specific Dosage Recommendation",
                                   "Alternative Medication Suggestions",
                                   "NLP Prescription Extraction"], label="Choose a feature", elem_classes="option-btn")
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Number(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Alternative Medication Suggestions")),
                gr.update(visible=(choice=="NLP Prescription Extraction")),
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    with gr.Tab("Profile"):
        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()
        profile_btn.click(show_profile, None, profile_info)

    with gr.Tab("Chatbot ‚Äì Vaidya"):
        def vaidya_chat(message, history):
            response = pipe(f"User asked: {message}\nAnswer as Vaidya, a helpful medical assistant.", max_new_tokens=150, temperature=0.7)[0]["generated_text

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM
import torch

# --- Use Granite 350M for speed ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer, device=0 if torch.cuda.is_available() else -1)

# --- Store user info ---
user_info = {"email": None, "history": None}

# --- Simple dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    drug = drug.lower()
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {age}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded. Please upload a prescription image.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(f"Extract structured drug info from: {text}", max_new_tokens=120, temperature=0.7)[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text: {text}<br>üíé Vaidya Output:<br>{granite_out}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Gradio UI ---
with gr.Blocks(css="""
.gradio-container {background-color: #FDE992}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    with gr.Tab("Features"):
        feature_choice = gr.Radio(["Drug Interaction Detection",
                                   "Age-Specific Dosage Recommendation",
                                   "Alternative Medication Suggestions",
                                   "NLP Prescription Extraction"], label="Choose a feature", elem_classes="option-btn")
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Number(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Alternative Medication Suggestions")),
                gr.update(visible=(choice=="NLP Prescription Extraction")),
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice=="Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice=="Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice=="Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice=="NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    with gr.Tab("Profile"):
        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()
        profile_btn.click(show_profile, None, profile_info)

    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot()
        msg = gr.Textbox(label="Type here")
        clear = gr.Button("Clear")

        def vaidya_chat(message, history):
            response = pipe(
                f"User asked: {message}\nAnswer as Vaidya, a helpful medical assistant.",
                max_new_tokens=150,
                temperature=0.7
            )[0]["generated_text"]
            history = history + [(message, response)]
            return history, history

        msg.submit(vaidya_chat, [msg, chatbot], [chatbot, chatbot])
        clear.click(lambda: ([], []), None, [chatbot, chatbot], queue=False)

demo.launch(share=True, debug=True)

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Use Granite 350M for speed ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)  # ‚úÖ no device arg

# --- Store user info ---
user_info = {"email": None, "history": None}

# --- Simple dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    drug = drug.lower()
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {age}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded. Please upload a prescription image.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(f"Extract structured drug info from: {text}", max_new_tokens=120, temperature=0.7)[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text: {text}<br>üíé Vaidya Output:<br>{granite_out}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Gradio UI ---
with gr.Blocks(css="""
.gradio-container {background-color: #FDE992}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    with gr.Tab("Features"):
        feature_choice = gr.Radio(["Drug Interaction Detection",
                                   "Age-Specific Dosage Recommendation",
                                   "Alternative Medication Suggestions",
                                   "NLP Prescription Extraction"], label="Choose a feature", elem_classes="option-btn")
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Number(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Alternative Medication Suggestions")),
                gr.update(visible=(choice=="NLP Prescription Extraction")),
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice=="Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice=="Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice=="Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice=="NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    with gr.Tab("Profile"):
        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()
        profile_btn.click(show_profile, None, profile_info)

    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot()
        msg = gr.Textbox(label="Type here")
        clear = gr.Button("Clear")

        def vaidya_chat(message, history):
            response = pipe(

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Use Granite 350M for speed ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)  # ‚úÖ no device arg

# --- Store user info ---
user_info = {"email": None, "history": None}

# --- Simple dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    drug = drug.lower()
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {age}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded. Please upload a prescription image.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(f"Extract structured drug info from: {text}", max_new_tokens=120, temperature=0.7)[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text: {text}<br>üíé Vaidya Output:<br>{granite_out}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Gradio UI ---
with gr.Blocks(css="""
.gradio-container {background-color: #FDE992}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    with gr.Tab("Features"):
        feature_choice = gr.Radio(["Drug Interaction Detection",
                                   "Age-Specific Dosage Recommendation",
                                   "Alternative Medication Suggestions",
                                   "NLP Prescription Extraction"], label="Choose a feature", elem_classes="option-btn")
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Number(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Alternative Medication Suggestions")),
                gr.update(visible=(choice=="NLP Prescription Extraction")),
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice=="Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice=="Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice=="Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice=="NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    with gr.Tab("Profile"):
        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()
        profile_btn.click(show_profile, None, profile_info)

    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot()
        msg = gr.Textbox(label="Type here")
        clear = gr.Button("Clear")

        def vaidya_chat(message, history):
            response = pipe(
                f"User asked: {message}\nAnswer as Vaidya, a helpful medical assistant.",
                max_new_tokens=150,
                temperature=0.7
            )[0]["generated_text"]
            history = history + [(message, response)]
            return history, history

        msg.submit(vaidya_chat, [msg, chatbot], [chatbot, chatbot])
        clear.click(lambda: ([], []), None, [chatbot,

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Fast Granite model (auto device via accelerate) ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)  # do not pass device

# --- Store user info ---
user_info = {"email": None, "history": None}

# --- Simple dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    try:
        age_val = float(age) if age is not None else None
    except:
        age_val = None
    drug = (drug or "").lower()
    if not age_val or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded. Please upload a prescription image.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract structured medication, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation (safe HTML/CSS) ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Build Gradio app ---
with gr.Blocks(css="""
.gradio-container {background-color: #FDE992}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()

        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"

        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()

        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"

        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names (comma-separated)", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)  # use Textbox to avoid float parsing quirks
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice == "Drug Interaction Detection")),         # drugs
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")), # age
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")), # drug
                gr.update(visible=(choice == "Alternative Medication Suggestions")), # alt_drug
                gr.update(visible=(choice == "NLP Prescription Extraction")),        # image
            )

        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"

        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()

        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"

        profile_btn.click(show_profile, None, profile_info)

    # Chatbot ‚Äì Vaidya
    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot(label="Conversation")
        msg = gr.Textbox(label="Type here")
        clear = gr.Button("Clear")

        def vaidya_chat(message, history):
            output = pipe(
                f"User asked: {message}\nAnswer as Vaidya, a helpful medical assistant.",
                max_new_tokens=150,
                temperature=0.7
            )[0]["generated_text"]
            history = (history or []) + [(message, output)]
            return history, ""  # return updated history and clear textbox

        msg.submit(vaidya_chat, [msg, chatbot], [chatbot, msg])
        clear.click(lambda: ([], ""), None, [chatbot, msg], queue=False)

# Launch
demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- Chatbot response function ---
def vaidya_chat(message, file, history):
    # If file uploaded, OCR it
    if file:
        try:
            text = pytesseract.image_to_string(Image.open(file))
            message = f"{message}\n[Attached file text: {text}]"
        except Exception as e:
            message = f"{message}\n[Error reading file: {e}]"

    raw = pipe(message, max_new_tokens=150, temperature=0.7)[0]["generated_text"]
    response = raw.strip()

    history = (history or []) + [(message, response)]
    return history, None, ""  # update history, clear file, clear textbox

# --- UI ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot(label="üí¨ Vaidya ‚Äì Your MedIntel Assistant", elem_classes="gr-chatbot")
        with gr.Row():
            msg = gr.Textbox(placeholder="Type your message here...", scale=4)
            file = gr.File(label="Upload file", type="file", scale=2)
            send = gr.Button("Send", scale=1)
        clear = gr.Button("Clear Conversation")

        send.click(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        msg.submit(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        clear.click(lambda: ([], None, ""), None, [chatbot, file, msg], queue=False)

demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- Chatbot response function ---
def vaidya_chat(message, file, history):
    # If file uploaded, OCR it
    if file:
        try:
            text = pytesseract.image_to_string(Image.open(file))
            message = f"{message}\n[Attached file text: {text}]"
        except Exception as e:
            message = f"{message}\n[Error reading file: {e}]"

    raw = pipe(message, max_new_tokens=150, temperature=0.7)[0]["generated_text"]
    response = raw.strip()

    # Modern Gradio format: list of dicts with role/content
    history = (history or []) + [
        {"role": "user", "content": message},
        {"role": "assistant", "content": response}
    ]
    return history, None, ""  # update history, clear file, clear textbox

# --- UI ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot(label="üí¨ Vaidya ‚Äì Your MedIntel Assistant", type="messages", elem_classes="gr-chatbot")
        with gr.Row():
            msg = gr.Textbox(placeholder="Type your message here...", scale=4)
            file = gr.File(label="Upload file", type="filepath", scale=2)
            send = gr.Button("Send", scale=1)
        clear = gr.Button("Clear Conversation")

        send.click(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        msg.submit(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        clear.click(lambda: ([], None, ""), None, [chatbot, file, msg], queue=False)

demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {drugs}</b>"

def dosage_recommendation(age, drug):
    drug = (drug or "").lower()
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if float(age) < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {age}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(f"Extract structured drug info from: {text}", max_new_tokens=120, temperature=0.7)[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Gradio UI ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),
                gr.update(visible=(choice=="Alternative Medication Suggestions")),
                gr.update(visible=(choice=="NLP Prescription Extraction")),
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice=="Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice=="Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice=="Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice=="NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()
        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"
        profile_btn.click(show_profile, None, profile_info)

    # Chatbot ‚Äì Vaidya
    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot(label="üí¨ Vaidya ‚Äì Your MedIntel Assistant", type="messages", elem_classes="gr-chatbot")
        with gr.Row():
            msg = gr.Textbox(placeholder

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model (auto device via accelerate) ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)  # do not pass device

# --- Persistent user info ---
user_info = {"email": None, "history": None}

# --- Dosage rules (demo only) ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Build full app ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()

        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"

        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()

        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"

        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice=="Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice=="NLP Prescription Extraction")),         # image
            )

        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"

        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()

        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"

        profile_btn.click(show_profile, None, profile_info)

    # Chatbot ‚Äì Vaidya
    with gr.Tab("Chatbot ‚Äì Vaidya"):
        chatbot = gr.Chatbot(label="üí¨ Vaidya ‚Äì Your MedIntel Assistant", type="messages", elem_classes="gr-chatbot")
        with gr.Row():
            msg = gr.Textbox(placeholder="Type your message here...", scale=4)
            file = gr.File(label="Upload file", type="filepath", scale=2)
            send = gr.Button("Send", scale=1)
        clear = gr.Button("Clear Conversation")

        def vaidya_chat(message, file_path, history):
            # Optional file OCR
            if file_path:
                try:
                    text = pytesseract.image_to_string(Image.open(file_path))
                    message = f"{message}\n[Attached file text: {text}]"
                except Exception as e:
                    message = f"{message}\n[Error reading file: {e}]"

            raw = pipe(message, max_new_tokens=150, temperature=0.7)[0]["generated_text"]
            response = raw.strip()

            # Append messages in modern format
            history = (history or []) + [
                {"role": "user", "content": message},
                {"role": "assistant", "content": response}
            ]
            return history, None, ""  # update history, clear file, clear textbox

        send.click(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        msg.submit(vaidya_chat, [msg, file, chatbot], [chatbot, file, msg])
        clear.click(lambda: ([], None, ""), None, [chatbot, file, msg], queue=False)

# Launch the app
demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Build full app ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice=="Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice=="NLP Prescription Extraction")),         # image
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Build full app ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice=="Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice=="NLP Prescription Extraction")),         # image
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("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")  # your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Vaidya Output:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px;} }
@keyframes fadeOut { to {opacity:0;} }
@keyframes fadeIn { to {opacity:1;} }
</style>
"""

# --- Build full app ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
.gr-chatbot {background-color:#fffbe6; border-radius:15px; padding:10px;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()
        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"
        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()
        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"
        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice=="Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice=="NLP Prescription Extraction")),         # image
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"
        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
login("YOUR_HF_TOKEN")  # replace with your token

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model for text extraction ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="YOUR_HF_TOKEN")
model = AutoModelForCausalLM.from_pretrained(model_name, token="YOUR_HF_TOKEN", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules (demo only) ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    # Demo placeholder
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    # Demo placeholder
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Extracted Info:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px);} }
@keyframes fadeOut { to {opacity:0);} }
@keyframes fadeIn { to {opacity:1);} }
</style>
"""

# --- Build full app without chatbot ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()

        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"

        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()

        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"

        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice == "Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice == "Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice == "NLP Prescription Extraction")),         # image
            )

        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"

        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()

        def show_profile():
            if user_info["email"]:
                return f"<b style='color:#3F51B5;'>üìÇ Profile<br>Email: {user_info['email']}<br>History: {user_info['history']}</b>"
            else:
                return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"

        profile_btn.click(show_profile, None, profile_info)

# Launch the app
demo.launch()

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

from huggingface_hub import login
# ‚ö†Ô∏è Replace with your actual Hugging Face token
login("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")

import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# --- Granite model ---
model_name = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(model_name, token="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")
model = AutoModelForCausalLM.from_pretrained(model_name, token="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", device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# --- User info store ---
user_info = {"email": None, "history": None}

# --- Dosage rules ---
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"}
}

# --- Feature functions ---
def drug_interaction(drugs):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age, drug):
    age_str = (age or "").strip()
    drug = (drug or "").strip().lower()
    if not age_str or not drug:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug in dosage_table:
        dose = dosage_table[drug]["child"] if age_val < 12 else dosage_table[drug]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug} at age {int(age_val)}: {dose}</b>"
    else:
        return f"<b style='color:#FC5A50;'>No dosage info available for {drug}</b>"

def alternative_medication(drug):
    drug = (drug or "").strip()
    if not drug:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug}</b>"

def nlp_extraction(image_path):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        granite_out = pipe(
            f"Extract medications, dosage, frequency, duration from this text:\n{text}",
            max_new_tokens=160,
            temperature=0.7
        )[0]["generated_text"]
        return f"<b style='color:#CC3970;'>üìÑ OCR Text:<br>{text.replace('\n','<br>')}<br><br>üíé Extracted Info:<br>{granite_out.replace('\n','<br>')}</b>"
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# --- Intro animation ---
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px);} }
@keyframes fadeOut { to {opacity:0);} }
@keyframes fadeIn { to {opacity:1);} }
</style>
"""

# --- Build full app without chatbot ---
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()

        def signup(email, history):
            user_info["email"] = email
            user_info["history"] = history
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email} with history saved.</b>"

        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()

        def signin(email):
            if user_info["email"] == email:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email}</b>"
            else:
                return f"<b style='color:#E91E63;'>‚ùå No account found for {email}</b>"

        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice=="Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice=="Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice=="Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice=="NLP Prescription Extraction")),         # image
            )
        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs, age, drug, alt_drug, image):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age, drug)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image)
            else:
                return "<b style='color:red;'>‚ùå Invalid choice</b>"

        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile

!pip install -q gradio transformers accelerate huggingface_hub pytesseract Pillow

# ----------------------------
# Auth: paste your HF token
# ----------------------------
from huggingface_hub import login
HF_TOKEN = "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"  # replace if needed
login(HF_TOKEN)

# ----------------------------
# Imports
# ----------------------------
import gradio as gr
import pytesseract
from PIL import Image
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM

# ----------------------------
# Model setup (Granite for text extraction)
# ----------------------------
MODEL_NAME = "ibm-granite/granite-4.0-h-350m"
tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME, token=HF_TOKEN)
model = AutoModelForCausalLM.from_pretrained(MODEL_NAME, token=HF_TOKEN, device_map="auto")
pipe = pipeline("text-generation", model=model, tokenizer=tokenizer)

# ----------------------------
# App state
# ----------------------------
user_info = {"email": None, "history": None}

# ----------------------------
# Demo dosage table
# ----------------------------
dosage_table = {
    "paracetamol": {"child": "250 mg every 6 hours", "adult": "500 mg every 6 hours"},
    "ibuprofen": {"child": "200 mg every 8 hours", "adult": "400 mg every 8 hours"},
}

# ----------------------------
# Feature functions
# ----------------------------
def drug_interaction(drugs: str):
    txt = (drugs or "").strip()
    if not txt:
        return "<b style='color:#FECB00;'>Please enter drug names to check interactions.</b>"
    # Placeholder result
    return f"<b style='color:#FECB00;'>üîç Interactions checked for: {txt}</b>"

def dosage_recommendation(age: str, drug: str):
    age_str = (age or "").strip()
    drug_norm = (drug or "").strip().lower()
    if not age_str or not drug_norm:
        return "<b style='color:#FC5A50;'>Please provide both age and drug name.</b>"
    try:
        age_val = float(age_str)
    except:
        return "<b style='color:#FC5A50;'>Age must be a number.</b>"
    if drug_norm in dosage_table:
        dose = dosage_table[drug_norm]["child"] if age_val < 12 else dosage_table[drug_norm]["adult"]
        return f"<b style='color:#FC5A50;'>üë∂üëµ Recommended dosage for {drug_norm} at age {int(age_val)}: {dose}</b>"
    return f"<b style='color:#FC5A50;'>No dosage info available for {drug_norm}</b>"

def alternative_medication(drug: str):
    drug_clean = (drug or "").strip()
    if not drug_clean:
        return "<b style='color:#B53389;'>Please provide a drug name for alternatives.</b>"
    # Placeholder result
    return f"<b style='color:#B53389;'>üíä Alternatives suggested for {drug_clean}</b>"

def nlp_extraction(image_path: str):
    if not image_path:
        return "<b style='color:red;'>‚ùå No image uploaded.</b>"
    try:
        text = pytesseract.image_to_string(Image.open(image_path))
        prompt = (
            "Extract structured info (medication, dosage, frequency, duration) from this prescription text:\n"
            f"{text}\n"
            "Return clear bullet points."
        )
        granite_out = pipe(prompt, max_new_tokens=160, temperature=0.7)[0]["generated_text"]
        return (
            "<b style='color:#CC3970;'>üìÑ OCR Text:<br>"
            + text.replace("\n", "<br>")
            + "<br><br>üíé Extracted Info:<br>"
            + granite_out.replace("\n", "<br>")
            + "</b>"
        )
    except Exception as e:
        return f"<b style='color:red;'>Error processing image: {e}</b>"

# ----------------------------
# Intro animation HTML
# ----------------------------
intro_html = """
<div style="text-align:center; font-family:sans-serif; background:linear-gradient(45deg,#FDE992,#F2C1D1,#CEA2FD); height:100vh; padding-top:50px;">
  <div id="pill" style="width:60px; height:120px; background:#4CAF50; border-radius:30px; margin:auto;
       animation:spin 3s linear, expand 3s ease-in-out 3s forwards, fadeOut 2s ease-in-out 5s forwards;"></div>
  <h1 style="opacity:0; color:#FECB00; animation:fadeIn 2s ease-in-out 7s forwards;">MedIntel</h1>
  <p style="opacity:0; color:#FC5A50; font-size:20px; animation:fadeIn 2s ease-in-out 9s forwards;">
    Where Health Meets Intelligence
  </p>
  <div style="font-size:80px; opacity:0; animation:fadeIn 2s ease-in-out 11s forwards;">üë®‚Äç‚öïÔ∏èüëã</div>
</div>
<style>
@keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
@keyframes expand { to {width:150px; height:150px);} }
@keyframes fadeOut { to {opacity:0);} }
@keyframes fadeIn { to {opacity:1);} }
</style>
"""

# ----------------------------
# Build full app (no chatbot)
# ----------------------------
with gr.Blocks(css="""
.gradio-container {background: linear-gradient(135deg,#FDE992,#F2C1D1,#CEA2FD);}
.option-btn label {
    display:inline-block;
    padding:20px 40px;
    margin:10px;
    border-radius:50px;
    background:linear-gradient(90deg,#FECB00,#FC5A50,#B53389,#CC3970);
    color:white;
    font-weight:bold;
    text-align:center;
    cursor:pointer;
    width:80%;
}
.option-btn:hover {opacity:0.85;}
""") as demo:
    # Intro
    with gr.Tab("Intro"):
        gr.HTML(intro_html)

    # Sign Up
    with gr.Tab("Sign Up"):
        email_up = gr.Textbox(label="Enter your email")
        history_up = gr.Textbox(label="Enter your medical history", lines=3)
        signup_btn = gr.Button("Sign Up")
        signup_msg = gr.HTML()

        def signup(email, history):
            email_clean = (email or "").strip()
            if not email_clean:
                return "<b style='color:#E91E63;'>‚ùå Please enter a valid email.</b>"
            user_info["email"] = email_clean
            user_info["history"] = history or ""
            return f"<b style='color:#4CAF50;'>‚úÖ Registered {email_clean} with history saved.</b>"

        signup_btn.click(signup, [email_up, history_up], signup_msg)

    # Sign In
    with gr.Tab("Sign In"):
        email_in = gr.Textbox(label="Enter your registered email")
        signin_btn = gr.Button("Sign In")
        signin_msg = gr.HTML()

        def signin(email):
            email_try = (email or "").strip()
            if not email_try:
                return "<b style='color:#E91E63;'>‚ùå Please enter your email.</b>"
            if user_info["email"] == email_try:
                return f"<b style='color:#4CAF50;'>‚úÖ Signed in as {email_try}</b>"
            return f"<b style='color:#E91E63;'>‚ùå No account found for {email_try}</b>"

        signin_btn.click(signin, email_in, signin_msg)

    # Features
    with gr.Tab("Features"):
        feature_choice = gr.Radio(
            ["Drug Interaction Detection",
             "Age-Specific Dosage Recommendation",
             "Alternative Medication Suggestions",
             "NLP Prescription Extraction"],
            label="Choose a feature",
            elem_classes="option-btn"
        )
        drugs = gr.Textbox(label="Enter drug names", visible=False)
        age = gr.Textbox(label="Enter age", visible=False)
        drug = gr.Textbox(label="Enter drug name", visible=False)
        alt_drug = gr.Textbox(label="Enter drug name", visible=False)
        image = gr.Image(type="filepath", label="Upload prescription image", visible=False)
        run_btn = gr.Button("Run")
        result = gr.HTML()

        def show_inputs(choice):
            return (
                gr.update(visible=(choice == "Drug Interaction Detection")),          # drugs
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")),  # age
                gr.update(visible=(choice == "Age-Specific Dosage Recommendation")),  # drug
                gr.update(visible=(choice == "Alternative Medication Suggestions")),  # alt_drug
                gr.update(visible=(choice == "NLP Prescription Extraction")),         # image
            )

        feature_choice.change(show_inputs, feature_choice, [drugs, age, drug, alt_drug, image])

        def run_feature(choice, drugs_v, age_v, drug_v, alt_drug_v, image_v):
            if choice == "Drug Interaction Detection":
                return drug_interaction(drugs_v)
            elif choice == "Age-Specific Dosage Recommendation":
                return dosage_recommendation(age_v, drug_v)
            elif choice == "Alternative Medication Suggestions":
                return alternative_medication(alt_drug_v)
            elif choice == "NLP Prescription Extraction":
                return nlp_extraction(image_v)
            return "<b style='color:red;'>‚ùå Invalid choice</b>"

        run_btn.click(run_feature, [feature_choice, drugs, age, drug, alt_drug, image], result)

    # Profile
    with gr.Tab("Profile"):
        profile_btn = gr.Button("Show Profile")
        profile_info = gr.HTML()

        def show_profile():
            if user_info["email"]:
                return (
                    "<b style='color:#3F51B5;'>üìÇ Profile<br>"
                    f"Email: {user_info['email']}<br>"
                    f"History: {user_info['history']}</b>"
                )
            return "<b style='color:#E91E63;'>‚ùå No user signed in</b>"

        profile_btn.click(show_profile, None, profile_info)

# Launch the app
demo.launch()

